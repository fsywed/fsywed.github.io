<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><title>ä»£ç é¢„è§ˆå™¨</title><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:Arial;background:#1e1e1e;color:#d4d4d4;height:100vh;display:flex;flex-direction:column}.header{background:#007acc;color:white;padding:10px;text-align:center}.container{display:flex;flex:1;overflow:hidden}.panel{flex:1;display:flex;flex-direction:column}.panel-header{background:#252526;padding:6px;border-bottom:1px solid #333;display:flex;justify-content:space-between;align-items:center}textarea{flex:1;background:#1e1e1e;color:#d4d4d4;border:none;padding:10px;font-family:Consolas,monospace;font-size:14px;resize:none;outline:none}#preview{flex:1;border:none;background:white}.button{background:#0e639c;color:white;border:none;padding:5px 10px;border-radius:3px;cursor:pointer;margin-left:3px;font-size:13px}.controls{padding:5px;background:#252526;border-top:1px solid #333;font-size:13px}.fullscreen{background:#d35400}.github{background:#28a745}#dialog{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#252526;padding:15px;border-radius:5px;box-shadow:0 5px 20px rgba(0,0,0,0.5);z-index:1000;display:none;width:350px}.overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);z-index:999;display:none}.file-status{margin:8px 0;padding:5px;background:#1a1a1a;border-radius:3px;font-size:12px}</style></head><body>
<div class="header"><h2 style="font-size:1.2rem;margin:0">ä»£ç é¢„è§ˆå™¨</h2><p style="margin:3px 0;font-size:0.8rem">ç¼–è¾‘ä»£ç ï¼Œå®æ—¶é¢„è§ˆ</p></div>
<div class="container">
<div class="panel"><div class="panel-header"><span>ç¼–è¾‘å™¨</span><select id="type" style="background:#1e1e1e;color:#d4d4d4;border:1px solid #444;padding:3px;font-size:12px"><option value="html">HTML</option><option value="css">CSS</option><option value="js">JS</option><option value="full">å®Œæ•´</option></select></div>
<textarea id="code"><!DOCTYPE html>
<html>
<body>
<h1>æµ‹è¯•</h1>
</body>
</html></textarea>
</div>
<div class="panel"><div class="panel-header"><span>é¢„è§ˆ</span><div><button class="button" onclick="R()">è¿è¡Œ</button><button class="button" onclick="E()">ç¤ºä¾‹</button><button class="button fullscreen" onclick="F()">å…¨å±</button><button class="button github" onclick="D()">æäº¤</button></div></div>
<iframe id="preview"></iframe></div></div>
<div class="controls"><label><input type="checkbox" id="auto" checked style="margin-right:3px">è‡ªåŠ¨åˆ·æ–°</label><span id="status" style="margin-left:5px">å°±ç»ª</span></div>
<div class="overlay" onclick="H()"></div>
<div id="dialog">
<div style="display:flex;justify-content:space-between;margin-bottom:8px"><h3 style="margin:0;font-size:1rem">æäº¤åˆ°GitHub</h3><span onclick="H()" style="cursor:pointer">Ã—</span></div>
<input id="file" placeholder="æ–‡ä»¶å" oninput="C()" style="width:100%;padding:6px;margin-bottom:6px;background:#1e1e1e;border:1px solid #444;color:#d4d4d4;border-radius:3px">
<textarea id="msg" placeholder="è¯´æ˜" rows="2" style="width:100%;padding:6px;margin-bottom:6px;background:#1e1e1e;border:1px solid #444;color:#d4d4d4;border-radius:4px">ä»£ç é¢„è§ˆå™¨æäº¤</textarea>
<input id="token" placeholder="GitHubä»¤ç‰Œ" oninput="C()" style="width:100%;padding:6px;margin-bottom:6px;background:#1e1e1e;border:1px solid #444;color:#d4d4d4;border-radius:3px">
<div id="fs" class="file-status">ç­‰å¾…è¾“å…¥</div>
<div style="text-align:right;margin-top:8px">
<button class="button" onclick="H()" style="background:#666;margin-right:4px">å–æ¶ˆ</button>
<button class="button github" onclick="S()">æäº¤</button>
</div>
</div>
<script>
let sha=null,checking=false;

// åŸºæœ¬åŠŸèƒ½
function R(){
    let c=document.getElementById('code').value,t=document.getElementById('type').value,h='';
    if(t==='full')h=c;
    else if(t==='html')h='<!DOCTYPE html><html><head><style>body{padding:10px}</style></head><body>'+c+'</body></html>';
    else if(t==='css')h='<!DOCTYPE html><html><head><style>'+c+'</style></head><body><div>CSSé¢„è§ˆ</div></body></html>';
    else if(t==='js')h='<!DOCTYPE html><html><body><script>try{'+c+'}catch(e){console.error(e)}<\/script></body></html>';
    document.getElementById('preview').srcdoc=h;
    document.getElementById('status').textContent='å·²æ›´æ–°';
}

function E(){
    let t=document.getElementById('type').value,e='<h2>ç¤ºä¾‹</h2>';
    if(t==='css')e='body{background:#f0f0f0}';
    else if(t==='js')e='console.log("ç¤ºä¾‹");';
    document.getElementById('code').value=e;
    R();
}

function F(){
    let p=document.querySelector('.panel:last-child');
    if(!document.fullscreenElement){
        p.requestFullscreen?p.requestFullscreen():p.webkitRequestFullscreen?p.webkitRequestFullscreen():p.mozRequestFullScreen&&p.mozRequestFullScreen();
        document.querySelector('.fullscreen').textContent='é€€å‡º';
    }else{
        document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen();
        document.querySelector('.fullscreen').textContent='å…¨å±';
    }
}

// GitHubåŠŸèƒ½
function D(){
    document.getElementById('dialog').style.display='block';
    document.querySelector('.overlay').style.display='block';
    let t=localStorage.getItem('token');
    if(t){
        document.getElementById('token').value=t;
        C();
    }
}

function H(){
    document.getElementById('dialog').style.display='none';
    document.querySelector('.overlay').style.display='none';
    sha=null;
}

// ä¿®å¤ï¼šæ£€æŸ¥æ–‡ä»¶é€»è¾‘
async function C(){
    if(checking) return;
    checking=true;
    
    let f=document.getElementById('file').value.trim();
    let t=document.getElementById('token').value.trim();
    let s=document.getElementById('fs');
    
    if(!f||!t){
        s.textContent='ç­‰å¾…è¾“å…¥';
        sha=null;
        checking=false;
        return;
    }
    
    // éªŒè¯ä»¤ç‰Œæ ¼å¼
    if(!t.startsWith('ghp_')&&!t.startsWith('github_pat_')){
        s.textContent='ä»¤ç‰Œæ ¼å¼é”™è¯¯';
        sha=null;
        checking=false;
        return;
    }
    
    s.textContent='æ£€æŸ¥ä¸­...';
    
    try{
        let r=await fetch(`https://api.github.com/repos/fsywed/fsywed.github.io/contents/${f}`,{
            headers:{'Authorization':'token '+t}
        });
        
        if(r.ok){
            let d=await r.json();
            sha=d.sha;
            s.textContent='ğŸ“ è¦†ç›–æ–‡ä»¶';
        }else if(r.status===404){
            sha=null;
            s.textContent='ğŸ“„ æ–°å»ºæ–‡ä»¶';
        }else{
            sha=null;
            s.textContent='æ£€æŸ¥å¤±è´¥';
        }
    }catch(e){
        sha=null;
        s.textContent='ç½‘ç»œé”™è¯¯';
    }
    
    checking=false;
}

async function S(){
    let f=document.getElementById('file').value.trim()||'test.html';
    let t=document.getElementById('token').value.trim();
    let m=document.getElementById('msg').value.trim();
    let c=document.getElementById('code').value;
    
    if(!t||(!t.startsWith('ghp_')&&!t.startsWith('github_pat_'))){
        alert('éœ€è¦æœ‰æ•ˆçš„GitHubä»¤ç‰Œ');
        return;
    }
    
    let b=document.querySelector('.github');
    b.disabled=true;
    b.textContent='æäº¤ä¸­';
    document.getElementById('status').textContent='æäº¤ä¸­...';
    
    try{
        let p={
            message:m||`æäº¤ ${new Date().toLocaleTimeString()}`,
            content:btoa(unescape(encodeURIComponent(c))),
            branch:'main'
        };
        
        // å…³é”®ä¿®å¤ï¼šåªæœ‰ç¡®å®šæœ‰shaæ—¶æ‰æ·»åŠ 
        if(sha!==null){
            p.sha=sha;
        }
        
        let r=await fetch(`https://api.github.com/repos/fsywed/fsywed.github.io/contents/${f}`,{
            method:'PUT',
            headers:{
                'Authorization':'token '+t,
                'Content-Type':'application/json'
            },
            body:JSON.stringify(p)
        });
        
        if(r.ok){
            document.getElementById('status').textContent='âœ… æˆåŠŸ';
            alert(sha?'âœ… æ–‡ä»¶å·²è¦†ç›–':'âœ… æ–‡ä»¶å·²åˆ›å»º');
            localStorage.setItem('token',t);
            H();
        }else{
            let e=await r.json();
            throw new Error(e.message||`é”™è¯¯ ${r.status}`);
        }
    }catch(e){
        document.getElementById('status').textContent='âŒ å¤±è´¥';
        alert('æäº¤å¤±è´¥: '+e.message);
    }finally{
        b.disabled=false;
        b.textContent='æäº¤';
    }
}

// äº‹ä»¶
document.getElementById('code').addEventListener('input',function(){
    if(document.getElementById('auto').checked){
        clearTimeout(window.T);
        window.T=setTimeout(R,500);
    }
});

document.getElementById('type').addEventListener('change',R);
window.addEventListener('load',R);
</script>
</body>
</html>
