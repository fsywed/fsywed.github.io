<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>在线代码预览器</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Arial;background:#1e1e1e;color:#d4d4d4;height:100vh;display:flex;flex-direction:column}
.header{background:#007acc;color:white;padding:15px;text-align:center}
.container{display:flex;flex:1;overflow:hidden}
.editor-panel,.preview-panel{flex:1;display:flex;flex-direction:column}
.panel-header{background:#252526;padding:10px;border-bottom:1px solid #333;display:flex;justify-content:space-between;align-items:center}
textarea{flex:1;background:#1e1e1e;color:#d4d4d4;border:none;padding:15px;font-family:Consolas,monospace;font-size:14px;resize:none;outline:none}
#iframePreview{flex:1;border:none;background:white}
.button{background:#0e639c;color:white;border:none;padding:8px 15px;border-radius:3px;cursor:pointer;margin-left:5px}
.button:hover{background:#1177bb}
.controls{padding:10px;background:#252526;border-top:1px solid #333}
</style>
</head>
<body>
<div class="header">
<h2>在线代码预览器</h2>
<p>编辑代码，实时查看效果（支持HTML/CSS/JS）</p>
</div>

<div class="container">
<div class="editor-panel">
<div class="panel-header">
<span>代码编辑器</span>
<select id="codeType">
<option value="html">HTML</option>
<option value="css">CSS</option>
<option value="js">JavaScript</option>
<option value="full">完整网页</option>
</select>
</div>
<textarea id="codeInput" placeholder="在这里输入代码...">
<!DOCTYPE html>
<html>
<head>
<style>
body { font-family: Arial; padding: 20px; }
.demo-box { 
  background: linear-gradient(45deg, #667eea, #764ba2);
  color: white; 
  padding: 30px; 
  border-radius: 10px;
  text-align: center;
  margin: 20px 0;
}
</style>
</head>
<body>
<div class="demo-box">
  <h1>测试页面</h1>
  <p>编辑左侧代码</p>
  <button onclick="alert('测试')">点击</button>
</div>
<script>
console.log('测试');
</script>
</body>
</html>
</textarea>
</div>

<div class="preview-panel">
<div class="panel-header">
<span>实时预览</span>
<div>
<button class="button" onclick="runCode()">运行</button>
<button class="button" onclick="saveCode()">保存</button>
<button class="button" onclick="loadExample()">示例</button>
</div>
</div>
<iframe id="iframePreview"></iframe>
</div>
</div>

<div class="controls">
<label><input type="checkbox" id="autoRefresh" checked> 自动刷新</label>
</div>

<script>
const codeInput=document.getElementById('codeInput');
const iframePreview=document.getElementById('iframePreview');
const codeTypeSelect=document.getElementById('codeType');
const autoRefresh=document.getElementById('autoRefresh');
let refreshTimer;

// 修复运行函数
function runCode(){
  const code=codeInput.value;
  const type=codeTypeSelect.value;
  let fullHTML='';
  
  if(type==='full'){
    fullHTML=code;
  }else if(type==='html'){
    fullHTML='<!DOCTYPE html><html><head><style>body{padding:20px}</style></head><body>'+code+'</body></html>';
  }else if(type==='css'){
    fullHTML='<!DOCTYPE html><html><head><style>'+code+'</style></head><body><div>CSS预览</div></body></html>';
  }else if(type==='js'){
    fullHTML='<!DOCTYPE html><html><body><script>try{'+code+'}catch(e){console.error(e)}<\/script></body></html>';
  }
  
  // 正确设置iframe内容
  iframePreview.srcdoc=fullHTML;
  console.log('代码已运行');
}

// 保存代码
function saveCode(){
  localStorage.setItem('code',codeInput.value);
  alert('已保存');
}

// 加载示例
function loadExample(){
  const type=codeTypeSelect.value;
  let example='';
  
  if(type==='html'){
    example='<h1>标题</h1><p>段落</p><button onclick="alert(\'点击\')">按钮</button>';
  }else if(type==='css'){
    example='body{background:#f0f0f0;padding:20px}\n.button{background:blue;color:white;padding:10px}';
  }else if(type==='js'){
    example='document.body.innerHTML="<h1>JS运行成功</h1>";\nalert("测试");';
  }else{
    example='<!DOCTYPE html><html><body><h1>完整示例</h1></body></html>';
  }
  
  codeInput.value=example;
  runCode();
}

// 自动刷新
codeInput.addEventListener('input',function(){
  if(autoRefresh.checked){
    clearTimeout(refreshTimer);
    refreshTimer=setTimeout(runCode,500);
  }
});

// 类型切换
codeTypeSelect.addEventListener('change',function(){
  runCode();
});

// 加载保存的代码
window.addEventListener('load',function(){
  const saved=localStorage.getItem('code');
  if(saved) codeInput.value=saved;
  runCode();
});
</script>
</body>
</html>
